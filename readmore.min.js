(function(e){function i(i,s){this.element=i;this.options=e.extend({},n,s);e(this.element).data("max-height",this.options.maxHeight);e(this.element).data("height-margin",this.options.heightMargin);delete this.options.maxHeight;if(this.options.embedCSS&&!r){var o=".readmore-js-toggle, .readmore-js-section { "+this.options.sectionCSS+" } .readmore-js-section { overflow: hidden; }";(function(e,t){var n=e.createElement("style");n.type="text/css";if(n.styleSheet){n.styleSheet.cssText=t}else{n.appendChild(e.createTextNode(t))}e.getElementsByTagName("head")[0].appendChild(n)})(document,o);r=true}this._defaults=n;this._name=t;this.init()}var t="readmore",n={speed:100,maxHeight:200,heightMargin:16,moreLink:'<a href="#">Read More</a>',lessLink:'<a href="#">Close</a>',embedCSS:true,sectionCSS:"display: block; width: 100%;",startOpen:false,expandedClass:"readmore-js-expanded",collapsedClass:"readmore-js-collapsed",beforeToggle:function(){},afterToggle:function(){}},r=false;i.prototype={init:function(){var t=this;e(this.element).each(function(){var n=e(this),r=n.css("max-height").replace(/[^-\d\.]/g,"")>n.data("max-height")?n.css("max-height").replace(/[^-\d\.]/g,""):n.data("max-height"),i=n.data("height-margin");if(n.css("max-height")!="none"){n.css("max-height","none")}t.setBoxHeight(n);if(n.outerHeight(true)<=r+i){return true}else{n.addClass("readmore-js-section "+t.options.collapsedClass).data("collapsedHeight",r);var s=t.options.startOpen?t.options.lessLink:t.options.moreLink;this.useLink=s;n.after(e(s).on("click",function(e){t.toggleSlider(this,n,e)}).addClass("readmore-js-toggle"));if(!t.options.startOpen){n.css({height:r})}}});e(window).on("resize",function(e){t.resizeBoxes()})},toggleSlider:function(t,n,r){if(n==undefined)t=e(this.element).parent().find(".readmore-js-toggle")[0];if(n==undefined)n=this.element;if(r!=undefined)r.preventDefault();var i=this,s=newLink=sectionClass="",o=false,u=e(n).data("collapsedHeight");if(e(n).height()<=u){s=e(n).data("expandedHeight")+"px";newLink="lessLink";o=true;sectionClass=i.options.expandedClass}else{s=u;newLink="moreLink";sectionClass=i.options.collapsedClass}i.options.beforeToggle(t,n,o);e(n).animate({height:s},{duration:i.options.speed,complete:function(){i.options.afterToggle(t,n,o);e(t).replaceWith(e(i.options[newLink]).on("click",function(e){i.toggleSlider(this,n,e)}).addClass("readmore-js-toggle"));e(this).removeClass(i.options.collapsedClass+" "+i.options.expandedClass).addClass(sectionClass)}})},setBoxHeight:function(e){var t=e.clone().css({height:"auto",width:e.width(),overflow:"hidden"}).insertAfter(e),n=t.outerHeight(true);t.remove();e.data("expandedHeight",n)},resizeBoxes:function(){var t=this;e(".readmore-js-section").each(function(){var n=e(this);t.setBoxHeight(n);if(n.height()>n.data("expandedHeight")||n.hasClass(t.options.expandedClass)&&n.height()<n.data("expandedHeight")){n.css("height",n.data("expandedHeight"))}})},destroy:function(){var t=this;e(this.element).each(function(){var n=e(this);n.removeClass("readmore-js-section "+t.options.collapsedClass+" "+t.options.expandedClass).css({"max-height":"",height:"auto"}).next(".readmore-js-toggle").remove();n.removeData()})}};e.fn[t]=function(n){var r=arguments;if(n===undefined||typeof n==="object"){return this.each(function(){if(e.data(this,"plugin_"+t)){var r=e.data(this,"plugin_"+t);r["destroy"].apply(r)}e.data(this,"plugin_"+t,new i(this,n))})}else if(typeof n==="string"&&n[0]!=="_"&&n!=="init"){return this.each(function(){var s=e.data(this,"plugin_"+t);if(s instanceof i&&typeof s[n]==="function"){s[n].apply(s,Array.prototype.slice.call(r,1))}})}}})(jQuery)
